sudo: required
language: python
dist: trusty
python:
    - "pypy"
    - "2.7"
    - "3.5"
    - "3.5-dev" # 3.5 development branch
    - "nightly" # currently points to 3.6-dev

branches:
    only:
        - master
        - develop
os:
  - linux
matrix:
  fast_finish: true
  allow_failures:
      - python: "3.5"
      - python: "3.5-dev"
      - python: "nightly"

# Install system dependencies
before_install:
  # Update System
  - sudo apt-get update -qq

  # Install dependencies
  - sudo apt-get install -qq automake libtool git

  # Fetch sources
  - git clone https://github.com/sass/libsass.git
  - git clone https://github.com/sass/sassc.git libsass/sassc

  # Create configure script
  - (cd libsass && autoreconf --force --install)
  # Create custom makefiles for **shared library**, for more info read:
  # 'Difference between static and shared libraries?' before installing libsass  http://stackoverflow.com/q/2649334/802365
  - (cd libsass && autoreconf --force --install && ./configure --disable-tests --enable-shared --prefix=/usr)

  # Build the library
  - make -C libsass -j5

  # Install the library
  - sudo make -C libsass -j5 install

install:
   - pip install --process-dependency-links .

before_script:
  # Required for running a test
  - pip install .[tests]

# command to run tests
script:
   - py.test

after_success:
   - coveralls

notifications:
  slack:
    secure: P15h0Cqryw9PIA1HP0QJcWoAuo3xMvKxVrwViYn/gGeCZ8qMRrH8wq/FCfm5oQIBKyoMK5w3Gecz9l9tu8MOqNy55B/Xns1uVY7oFalieNM0rlHqz7h29/tvQQIVuoidp8AZa0Uvm8UH0BTfkcsgOB++zaC8Rk4Rc69uFWjR28DN/FtUFZ+mqGP4cidmcvB/YTf8Iu0X4cVOzGGyqunpXW0f/mU+9rZ2/V3J0JwgC/VPFWrLzaUtfI2CLXBibHvOoJVn6J/fRvHv5q+wQJyC9YLwE3zX1MF9x6Htxyp/H5Mqf7s+cnTc6bKAGySare0kK3E9K+TfRNXHcjmKxPK/2EpM2dm11KISutpgD8+k7opqPP3qlHf97gWQ9lwUt5nH8DJv0nNpEIoz5JdjkbZwU/A8o3Hn8BZU8geg0vxG2mfhCmi8WK4igxPGniMxqs6uP06mH4jhBnsSqrjBb2Jv++uv07ZbLN4+KbLWXYLbeV5D8sZwdv1UZQvJq0nEQljEyAsfRle2FP6iKKZJVDflMWaMXmFmU+r7eg9zKFODT61tjs9qQZ7i5EdH7S09mWi/o/AzI9qLq0dpk0RkjO95vWQmSuB7YPevhYG+/+URBuqvog6sUEcIvKX2tRWPtIXYaZh+Pvf8GPPXRDaGsx6hFx+OB9l0nGA0Hge1b37S/Ag=
